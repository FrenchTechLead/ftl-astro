Skip to content You signed in with another tab or window. Reload to refresh your session. You signed out in another tab or window. Reload to refresh your session. You switched accounts on another tab or window. Reload to refresh your session. Dismiss alert {{ message }} afnanenayet / diffsitter Public Notifications You must be signed in to change notification settings Fork 33 Star 1.9k A tree-sitter based AST difftool to get meaningful semantic diffs License MIT license 1.9k stars 33 forks Branches Tags Activity Star Notifications You must be signed in to change notification settings afnanenayet/diffsitter mainBranchesTagsGo to fileCodeOpen more actions menuFolders and filesNameNameLast commit messageLast commit dateLatest commit History747 Commits.config.config .github.github assetsassets binbin deploymentdeployment dev\_scriptsdev\_scripts docsdocs grammarsgrammars resources/test\_configsresources/test\_configs srcsrc test\_datatest\_data teststests .dockerignore.dockerignore .gitignore.gitignore .gitmodules.gitmodules .pre-commit-config.yaml.pre-commit-config.yaml CODEOWNERSCODEOWNERS Cargo.lockCargo.lock Cargo.tomlCargo.toml Cross.tomlCross.toml DockerfileDockerfile LICENSELICENSE README.mdREADME.md build.rsbuild.rs clippy.tomlclippy.toml rustfmt.tomlrustfmt.toml View all filesRepository files navigationdiffsitter Disclaimer diffsitter is very much a work in progress and nowhere close to production ready (yet). Contributions are always welcome! Summary diffsitter creates semantically meaningful diffs that ignore formatting differences like spacing. It does so by computing a diff on the AST (abstract syntax tree) of a file rather than computing the diff on the text contents of the file. diffsitter uses the parsers from the tree-sitter project to parse source code. As such, the languages supported by this tool are restricted to the languages supported by tree-sitter. diffsitter supports the following languages: Bash C# C++ CSS Go Java OCaml PHP Python Ruby Rust Typescript/TSX HCL Examples Take the following files: a.rs fn main() { let x = 1; } fn add\_one { } b.rs fn main () { } fn addition() { } fn add\_two() { } The standard output from diff will get you: 1,2c1,12 < fn main() { < let x = 1; --- > fn > > > > main > > () > > { > } > > fn addition() { 5c15 < fn add\_one { --- > fn add\_two() { You can see that it picks up the formatting differences for the main function, even though they aren't semantically different. Check out the output from diffsitter: test\_data/short/rust/a.rs -> test\_data/short/rust/b.rs ====================================================== 9: -- + } 11: --- + fn addition() { 1: -- - let x = 1; 14: --- + fn add\_two() { 4: -- - fn add\_one { Note: the numbers correspond to line numbers from the original files. You can also filter which tree sitter nodes are considered in the diff through the config file. Since it uses the AST to calculate the difference, it knows that the formatting differences in main between the two files isn't a meaningful difference, so it doesn't show up in the diff. diffsitter has some nice (terminal aware) formatting too: It also has extensive logging if you want to debug or see timing information: Node filtering You can filter the nodes that are considered in the diff by setting include\_nodes or exclude\_nodes in the config file. exclude\_nodes always takes precedence over include\_nodes, and the type of a node is the kind of a tree-sitter node. The kind directly corresponds to whatever is reported by the tree-sitter API, so this example may occasionally go out of date. This feature currently only applies to leaf nodes, but we could exclude nodes recursively if there's demand for it. "input-processing": { // You can exclude different tree sitter node types - this rule takes precedence over \`include\_kinds\`. "exclude\_kinds": \["string\_content"\], // You can specifically allow only certain tree sitter node types "include\_kinds": \["method\_definition"\], } Installation Published binaries This project uses Github actions to build and publish binaries for each tagged release. You can download binaries from there if your platform is listed. We publish nightly releases as well as tagged stable releases. Cargo You can build from source with cargo using the following command: cargo install diffsitter --bin diffsitter If you want to generate completion files and other assets you can install the diffsitter\_completions binary with the following command: cargo install diffsitter --bin diffsitter\_completions Homebrew You can use my tap to install diffsitter: brew tap afnanenayet/tap brew install diffsitter # brew install afnanenayet/tap/diffsitter Arch Linux (AUR) @samhh has packaged diffsitter for arch on the AUR. Use your favorite AUR helper to install diffsitter-bin. Alpine Linux Install package diffsitter from the Alpine Linux repositories (on v3.16+ or Edge): apk add diffsitter Tree-sitter grammars are packaged separately (search for tree-sitter-\*). You can install individual packages you need or the virtual package tree-sitter-grammars to install all of them. Building with Docker We also provide a Docker image that builds diffsitter using the standard Rust base image. It separates the compilation stage from the run stage, so you can build it and run with the following command (assuming you have Docker installed on your system): docker build -t diffsitter . docker run -it --rm --name diffsitter-interactive diffsitter Usage For detailed help you can run diffsitter --help (diffsitter -h provides brief help messages). You can configure file associations and formatting options for diffsitter using a config file. If a config is not supplied, the app will use the default config, which you can see with diffsitter dump-default-config. It will look for a config at ${XDG\_HOME:-$HOME}/.config/diffsitter/config.json5 on macOS and Linux, and the standard directory for Windows. You can also refer to the sample config. You can override the default config path by using the --config flag or set the DIFFSITTER\_CONFIG environment variable. Note: the tests for this crate check to make sure the provided sample config is a valid config. Git integration To see the changes to the current git repo in diffsitter, you can add the following to your repo's .git/config and run git difftool. \[diff\] tool = diffsitter \[difftool\] prompt = false \[difftool "diffsitter"\] cmd = diffsitter "$LOCAL" "$REMOTE" Shell Completion You can generate shell completion scripts using the binary using the gen-completion subcommand. This will print the shell completion script for a given shell to STDOUT. You should use the help text for the most up to date usage information, but general usage would look like this: diffsitter gen-completion bash > completion.bash We currently support the following shells (via clap\_complete): Bash Zsh Fish Elvish Powershell Dependencies diffsitter is usually compiled as a static binary, so the tree-sitter grammars/libraries are baked into the binary as static libraries. There is an option to build with support for dynamic libraries which will look for shared library files in the user's default library path. This will search for library files of the form libtree-sitter-{lang}.{ext}, where lang is the language that the user is trying to diff and ext is the platform-specific extension for shared library files (.so, .dylib, etc). The user can override the dynamic library file for each language in the config as such: { "grammar": { // You can specify the dynamic library names for each language "dylib-overrides": { // with a filename "rust": "libtree-sitter-rust.so", // with an absolute path "c": "/usr/lib/libtree-sitter-c.so", // with a relative path "cpp": "../libtree-sitter-c.so", }, } } The above excerpt was taken from the sample config. Questions, Bugs, and Support If you notice any bugs, have any issues, want to see a new feature, or just have a question, feel free to open an issue or create a discussion post. If you file an issue, it would be preferable that you include a minimal example and/or post the log output of diffsitter (which you can do by adding the -d/--debug flag). Contributing See CONTRIBUTING.md. Similar Projects difftastic locust gumtree diffr delta Semantic Diff Tool About A tree-sitter based AST difftool to get meaningful semantic diffs Topics rust tree-sitter parser diff ast Resources Readme License MIT license Code of conduct Code of conduct Uh oh! There was an error while loading. Please reload this page. Activity Stars 1.9k stars Watchers 10 watching Forks 33 forks Report repository Releases 35 v0.9.0 Latest Apr 27, 2025 + 34 releases Uh oh! There was an error while loading. Please reload this page. Contributors 14 Languages Rust 89.0% Shell 7.9% Python 1.6% C++ 1.2% Other 0.3% You canâ€™t perform that action at this time.
---
import MetaHead from "@comps/MetaHead.astro";
import Header from "@comps/Header.astro";
import Footer from "@comps/Footer.astro";
import Styles from "@comps/styles/Styles.astro";
import BlogPostPreview from "@comps/BlogPostPreview.astro";
import NewsLetter from "@comps/NewsLetter.astro";
import { onlyUniqueArrayFilter } from "src/utils/utils";

const techPosts = await Astro.glob("/src/pages/posts/tech/*.mdx");

const uniqueTags = techPosts
  .map((a) => a.frontmatter.tags)
  .flatMap((a) => a)
  .map((a) => a.toLowerCase())
  .filter(onlyUniqueArrayFilter);

const DEV = await import.meta.env.DEV;

const title = "FrenchTechLead - The Tech Leaders Community";
const author = "FrenchTechLead";
const description =
  "FrenchTechLead is a blog about Software Engineering and Web Development, written by a team of Experienced Entrepreneurs.";
const keywords = [
  "Tech Blog",
  "Software Engineering",
  "Cloud Computing",
  "OOP",
  "Reactive Programming",
  "Functional Programming",
  "OSS",
  "DevOps",
];
const permalink = "https://frenchtechlead.com/blog/";
const postImageUrl = "https://frenchtechlead.com/assets/blog/blog-cover.avif";
const showAds = false;

const s = {
  postsList: "margin-top: 50px;",
  postElement:
    "color: var(--color-white); text-shadow: 0 0 30px var(--color-blue);",
  tag: [
    "display: inline-block",
    "border-radius: 20px",
    "color: white",
    "padding: 5px",
    "margin:5px",
    "background-color: var(--color-heavy-blue)",
  ].join(";"),
};
---

<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
  <head>
    <MetaHead
      title={title}
      keywords={keywords}
      description={description}
      permalink={permalink}
      postImageUrl={postImageUrl}
      author={author}
      showAds={showAds}
    />
    <Styles />
  </head>
  <body>
    <Header />
    <main class="container">
      <section class="mt-4">
        <h1>Recherche</h1>
        <div class="input-group mb-3" style="max-width: 420px;">
          <input
            type="text"
            class="form-control"
            placeholder="Recherchez dans le site"
            aria-label="Recherchez dans le site"
            aria-describedby="button-addon2"
            list="tags"
            onchange="goToPage(this)"
          />

          <button
            class="btn btn-outline-secondary"
            type="button"
            id="button-addon2">Rechercher</button
          >
        </div>
        <datalist id="tags">
          {
            uniqueTags.map((a) => (
              <option class="tag-option" value={a}>
                {a}
              </option>
            ))
          }
        </datalist>
      </section>
      <section style={s.postsList} aria-label="Blog post list">
        <h2 style={s.postElement}>Latest posts ðŸ”¥</h2>
        {
          techPosts
            .filter((p) => DEV || !p.frontmatter.draft)
            .reverse()
            .map((p) => (
              <BlogPostPreview post={p.frontmatter as any} url={p.url + "/"} />
            ))
        }
      </section>
      <NewsLetter />
      <script is:inline>
        function goToPage(e) {
          const txt = e.value;
          const allTags = document.querySelectorAll(".tag-option");
          allTags.forEach((z) => {
            if (z.value === txt) {
              window.location.replace("/blog/tag/" + txt);
            } else {
              console.log(z.value, txt);
            }
          });
        }
      </script>
    </main>
    <Footer />
  </body>
</html>

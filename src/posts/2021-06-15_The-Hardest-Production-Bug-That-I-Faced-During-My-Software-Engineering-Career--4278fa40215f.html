<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>The Hardest Production Bug That I Faced During My Software Engineering Career.</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">The Hardest Production Bug That I Faced During My Software Engineering Career.</h1>
</header>
<section data-field="subtitle" class="p-summary">
In this article, I‚Äôll describe the weirdest Internet Explorer bug that I faced in my life, how we diagnosed it and the way we managed to‚Ä¶
</section>
<section data-field="body" class="e-content">
<section name="8d60" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="eacd" id="eacd" class="graf graf--h3 graf--leading graf--title">The Hardest Production Bug That I Faced During My Software Engineering Career.</h3><figure name="e12f" id="e12f" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*DoBX7LLi0KKOvKHUOseUsQ.png" data-width="1500" data-height="750" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*DoBX7LLi0KKOvKHUOseUsQ.png"><figcaption class="imageCaption">The unexpected ‚ÄúNot Modified‚Äù screen.</figcaption></figure><p name="07a3" id="07a3" class="graf graf--p graf-after--figure graf--trailing">In this article, I‚Äôll describe the weirdest Internet Explorer bug that I faced in my life, how we <strong class="markup--strong markup--p-strong">diagnosed it,</strong> and the way we managed <strong class="markup--strong markup--p-strong">to correct it</strong> in my company.</p></div></div></section><section name="b7a8" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="7d5e" id="7d5e" class="graf graf--p graf--leading graf--trailing">By the time you‚Äôre reading this article, IE might not exist anymore since Microsoft has announced its abandonment by <a href="https://blogs.windows.com/windowsexperience/2021/05/19/the-future-of-internet-explorer-on-windows-10-is-in-microsoft-edge/" data-href="https://blogs.windows.com/windowsexperience/2021/05/19/the-future-of-internet-explorer-on-windows-10-is-in-microsoft-edge/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">June 15, 2022</a>, so most companies and individuals should work on moving to another browser in order to stay safe, this is good news for web developers because they know that Internet Explorer has always been a pain-in-the-neck when it comes to web development, mostly because of its various CSS and JavaScript incompatibilities, often we can find some polyfills for these kinds of issues; <strong class="markup--strong markup--p-strong">The issue I‚Äôm going to describe in this article isn‚Äôt related to JS or CSS, it‚Äôs a very weird behavior from IE when it receives an exotic HTTP response, so for once we can‚Äôt really say that its IE‚Äôs fault.</strong></p></div></div></section><section name="1ce4" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="0663" id="0663" class="graf graf--h4 graf--leading">The context¬†üìÉ</h4><p name="7586" id="7586" class="graf graf--p graf-after--h4">I work on a B2B project in an insurance company, one of our clients deploys IE as the default browser in all of its IT infrastructure, so we need to make sure that our websites run on IE as perfectly as it does on other browsers, <strong class="markup--strong markup--p-strong">recently our client has reported us a serious bug affecting one of our websites, this bug was so exotic that I‚Äôve decided to write a blog post about it.</strong></p><p name="b289" id="b289" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Basically, the bug affects the display of our website by adding multiple lines of the ‚ÄúNot Modified‚Äù string followed by some HTTP headers at the beginning of the DOM of our website.</strong></p><p name="81b8" id="81b8" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">What makes the bug so exotic </strong>üëΩ</p><ul class="postList"><li name="55d9" id="55d9" class="graf graf--li graf-after--p">The bug occurs randomly.</li><li name="44c3" id="44c3" class="graf graf--li graf-after--li">We couldn‚Äôt reproduce the bug more than a few times after thousands of tries.</li><li name="57be" id="57be" class="graf graf--li graf-after--li">It only happens on IE and on the production environment.</li><li name="b98b" id="b98b" class="graf graf--li graf-after--li graf--trailing">No major changes were pushed to prod before the bug report.</li></ul></div></div></section><section name="5dbe" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="bc7d" id="bc7d" class="graf graf--h4 graf--leading">Reproducing the Bug¬†üêõ</h4><p name="f9e8" id="f9e8" class="graf graf--p graf-after--h4">This was a hard task because of the randomness of the bug, even after thousands of refreshes on an identical ecosystem of our client, we didn‚Äôt manage to reproduce the bug on our machines, what we end-up doing was creating a Selenium program that refreshes the page for us and checks for the <strong class="markup--strong markup--p-strong">‚ÄúNot Modified‚Äù</strong> string in the DOM of our page.</p><figure name="7874" id="7874" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*RXCYgmWzgxG4Z_3cK7z4xw.png" data-width="1498" data-height="1082" src="https://cdn-images-1.medium.com/max/800/1*RXCYgmWzgxG4Z_3cK7z4xw.png"><figcaption class="imageCaption">Python Script for reproducing the¬†bug</figcaption></figure><p name="dff2" id="dff2" class="graf graf--p graf-after--figure">After running this program for some time, we managed to reproduce the bug and export the HTML containing the <strong class="markup--strong markup--p-strong">‚ÄúNot Modified‚Äù</strong> string.</p><figure name="bcb8" id="bcb8" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*DoBX7LLi0KKOvKHUOseUsQ.png" data-width="1500" data-height="750" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*DoBX7LLi0KKOvKHUOseUsQ.png"><figcaption class="imageCaption">The unexpected ‚ÄúNot Modified‚Äù screen.</figcaption></figure><blockquote name="0595" id="0595" class="graf graf--blockquote graf-after--figure">Now that we managed to reproduce the bug we need to understand how the heck we end up having this unexpected content at the top of our page.</blockquote><p name="c611" id="c611" class="graf graf--p graf-after--blockquote">For this purpose, we had to look at the architecture of the app from an infrastructure perspective:</p><figure name="35eb" id="35eb" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*D9iJvc3_8KQm3OpBCuJP6A.png" data-width="2540" data-height="1261" src="https://cdn-images-1.medium.com/max/800/1*D9iJvc3_8KQm3OpBCuJP6A.png"><figcaption class="imageCaption">The Infrastructure Architecture of the¬†app.</figcaption></figure><p name="d33d" id="d33d" class="graf graf--p graf-after--figure">From the following architecture, we identified some potential guilty components and had some assumptions.</p><p name="6b09" id="6b09" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">What components can edit the HTML rendered pages?</em></strong></p><ol class="postList"><li name="e431" id="e431" class="graf graf--li graf-after--p">The Mashup server is responsible for Server-Side integration, it acts directly on the HTML rendering, it might have a bug when retrieving cached assets from the CMS, so we tried to disable cache on the CMS server but the bug was still there.</li><li name="0b0e" id="0b0e" class="graf graf--li graf-after--li graf--trailing">Javascript can edit the HTML on the client-side after sending some XHR requests, we analyzed the XHR requests one by one, but none of them had a 304 response code, but <strong class="markup--strong markup--li-strong">we observed that the ‚ÄúNot Modified‚Äù string was not part of the first paint content</strong>, so we had a strong belief that Javascript was responsible for the bug at this point (later we knew that we were wrong ).</li></ol></div></div></section><section name="657e" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="a71e" id="a71e" class="graf graf--h4 graf--leading">Getting Deeper into debugging üßø</h4><blockquote name="d639" id="d639" class="graf graf--blockquote graf-after--h4">At that time, we knew certainly that the issue occurs on the client-side since the ‚Äúnot modified‚Äù string is not part of the first paint content.</blockquote><p name="6c99" id="6c99" class="graf graf--p graf-after--blockquote">We had a strong belief that some JS was responsible for printing these weird headers on the screen, we analyzed all the libraries that we use on our legacy JSF app (Application backend), we had many JS libraries to analyze such as <a href="https://sarissa.sourceforge.io/howtos.html" data-href="https://sarissa.sourceforge.io/howtos.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Sarissa JS</a>, Sarissa was easy to point to because it acts as a wrapper for XHR requests, we have reviewed almost all of our JS code just to realize that not a single line of our JS injects these undesired headers on the DOM of our app.</p><blockquote name="5d96" id="5d96" class="graf graf--blockquote graf-after--p">At this point we knew that the bug occurs on the client-side but Javascript was not responsible for it.</blockquote><p name="d7fe" id="d7fe" class="graf graf--p graf-after--blockquote">Unlike recent web browsers like Chrome and Firefox, IE doesn‚Äôt have some decent debugging capabilities, and the network tab on IE misled us in our investigations, let me explain how¬†:</p><figure name="8c17" id="8c17" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*lz8kAdNssyDorLGBOXg4xw.png" data-width="1920" data-height="538" src="https://cdn-images-1.medium.com/max/800/1*lz8kAdNssyDorLGBOXg4xw.png"><figcaption class="imageCaption">IE‚Ää‚Äî‚ÄäNetwork¬†tab</figcaption></figure><p name="2e8d" id="2e8d" class="graf graf--p graf-after--figure">The misleading thing about the network tab here is the fact that an HTTP 304 response is associated with a Body content, there is no indication that the Body is retrieved from the local cache and not from the actual response(that should have no Body content associated to it), so if you don‚Äôt really pay attention, you get easily into thinking that the Body has been returned from the server with the 304 response.</p><p name="0445" id="0445" class="graf graf--p graf-after--p">We decided to view how a single 304 resource is received from our backend, for that, we used a very interesting program called Fiddler which is a debugging proxy server tool used to log, inspect, and alter HTTP and even HTTPS traffic between a web client and a web server.</p><figure name="3de2" id="3de2" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*4XuTHDlzXJ4v9i5UemnbhA.png" data-width="1716" data-height="642" src="https://cdn-images-1.medium.com/max/800/1*4XuTHDlzXJ4v9i5UemnbhA.png"><figcaption class="imageCaption">HTTP 304 response with a¬†Body!</figcaption></figure><h4 name="30cd" id="30cd" class="graf graf--h4 graf-after--figure">Bingo!</h4><p name="cfeb" id="cfeb" class="graf graf--p graf-after--h4">We have found a serious lead by using Fiddler, we noticed that our 304 response has a Body content (12 bytes) which is a violation of the HTTP protocol.</p><blockquote name="cdd3" id="cdd3" class="graf graf--blockquote graf-after--p">A 304 response <a href="https://httpstatuses.com/304" data-href="https://httpstatuses.com/304" class="markup--anchor markup--blockquote-anchor" rel="noopener" target="_blank">cannot contain a message-body</a>; it is always terminated by the first empty line after the header fields.</blockquote><p name="fbc0" id="fbc0" class="graf graf--p graf-after--blockquote">Check out the following article to learn HTTP the right way¬†:)</p><div name="9f49" id="9f49" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://mecheri-akram.medium.com/before-learning-rest-soap-graphql-you-need-to-understand-http-9eb80de6cfbf" data-href="https://mecheri-akram.medium.com/before-learning-rest-soap-graphql-you-need-to-understand-http-9eb80de6cfbf" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://mecheri-akram.medium.com/before-learning-rest-soap-graphql-you-need-to-understand-http-9eb80de6cfbf"><strong class="markup--strong markup--mixtapeEmbed-strong">Before Learning Rest / Soap / GraphQL / You Need To Understand HTTP¬†!</strong><br><em class="markup--em markup--mixtapeEmbed-em">HTTP stands for Hypertext Transfer Protocol, initially created for web browser/server communication, it has many more‚Ä¶</em>mecheri-akram.medium.com</a><a href="https://mecheri-akram.medium.com/before-learning-rest-soap-graphql-you-need-to-understand-http-9eb80de6cfbf" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="c7cf00f58c13c8dcba31a591cd6820a5" data-thumbnail-img-id="0*x6RlFfWpFDEEDYaR.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*x6RlFfWpFDEEDYaR.png);"></a></div><p name="0f3e" id="0f3e" class="graf graf--p graf-after--mixtapeEmbed"><strong class="markup--strong markup--p-strong">So we know now that our servers are returning some exotic HTTP responses for cached resources, and unlike Chrome and Firefox, IE does not tolerate this protocol violation and acts weirdly by printing the Body of these responses directly onto the DOM.</strong></p><h4 name="cf73" id="cf73" class="graf graf--h4 graf-after--p">So where did the 304 HTTP response got the Body¬†from?</h4><p name="ad2a" id="ad2a" class="graf graf--p graf-after--h4">When we GET a resource directly from the Mashup Server we receive a 304 response with no Body content (L.1), but when going through the RP we receive a 304 response that has a Body content(L.2).</p><figure name="0f69" id="0f69" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*hkZWk43fnCKtdWNQz25Pdw.png" data-width="1135" data-height="80" src="https://cdn-images-1.medium.com/max/800/1*hkZWk43fnCKtdWNQz25Pdw.png"><figcaption class="imageCaption">Tomcat access¬†log</figcaption></figure><p name="60e8" id="60e8" class="graf graf--p graf-after--figure">The RP connects to the Mashup Server through <a href="https://en.wikipedia.org/wiki/Apache_JServ_Protocol" data-href="https://en.wikipedia.org/wiki/Apache_JServ_Protocol" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">AJP</a> Protocol, we did some research about the AJP connector of our Tomcat server and it turned out that there is indeed a <a href="https://bz.apache.org/bugzilla/show_bug.cgi?id=55453" data-href="https://bz.apache.org/bugzilla/show_bug.cgi?id=55453" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">problem with this connector</a>.</p><p name="3af0" id="3af0" class="graf graf--p graf-after--p graf--trailing">The bug was fixed on Tomcat version 7.0.43 onwards, so we just had to upgrade the version of our Tomcat server to correct this issue.</p></div></div></section><section name="fb8c" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="6441" id="6441" class="graf graf--h4 graf--leading">Final thoughts:</h4><p name="e1bb" id="e1bb" class="graf graf--p graf-after--h4 graf--trailing">I took the time to write about this particular experience for many reasons, Firstly, I hope that people facing similar Bugs would find help here, Then for my fellow web developers, I want to point out the importance of knowing your apps on all of its layers, don‚Äôt be an exclusive front-end or back-end developer, otherwise, you won‚Äôt be able to diagnose some serious bugs like the one described on this article, Finally, to product managers out there, please stop using/supporting IE¬†:)</p></div></div></section><section name="d1df" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="b9cf" id="b9cf" class="graf graf--p graf--leading"><strong class="markup--strong markup--p-strong">That‚Äôs it</strong>, if you find this article interesting don‚Äôt hesitate to let me a comment and/or hit the üëè button below.</p><h4 name="2870" id="2870" class="graf graf--h4 graf-after--p">References:</h4><div name="2690" id="2690" class="graf graf--mixtapeEmbed graf-after--h4"><a href="https://httpstatuses.com/304" data-href="https://httpstatuses.com/304" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://httpstatuses.com/304"><strong class="markup--strong markup--mixtapeEmbed-strong">304 Not Modified</strong><br><em class="markup--em markup--mixtapeEmbed-em">A conditional GET or HEAD request has been received and would have resulted in a 200 OK response if it were not for the‚Ä¶</em>httpstatuses.com</a><a href="https://httpstatuses.com/304" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="a6e8fed04f658d1ff6491574efb5b1ab"></a></div><div name="6f37" id="6f37" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed"><a href="https://bz.apache.org/bugzilla/show_bug.cgi?id=55453" data-href="https://bz.apache.org/bugzilla/show_bug.cgi?id=55453" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://bz.apache.org/bugzilla/show_bug.cgi?id=55453"><strong class="markup--strong markup--mixtapeEmbed-strong">55453 - AJP send Body with Status 304</strong><br><em class="markup--em markup--mixtapeEmbed-em">Edit description</em>bz.apache.org</a><a href="https://bz.apache.org/bugzilla/show_bug.cgi?id=55453" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="7a50e4475318bf0ba4c2eeaf54de7473"></a></div><div name="c6eb" id="c6eb" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed graf--trailing"><a href="https://blogs.windows.com/windowsexperience/2021/05/19/the-future-of-internet-explorer-on-windows-10-is-in-microsoft-edge/" data-href="https://blogs.windows.com/windowsexperience/2021/05/19/the-future-of-internet-explorer-on-windows-10-is-in-microsoft-edge/" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://blogs.windows.com/windowsexperience/2021/05/19/the-future-of-internet-explorer-on-windows-10-is-in-microsoft-edge/"><strong class="markup--strong markup--mixtapeEmbed-strong">The future of Internet Explorer on Windows 10 is in Microsoft Edge</strong><br><em class="markup--em markup--mixtapeEmbed-em">Over the last year, you may have noticed our movement away from Internet Explorer (&quot;IE&quot;) support, such as an‚Ä¶</em>blogs.windows.com</a><a href="https://blogs.windows.com/windowsexperience/2021/05/19/the-future-of-internet-explorer-on-windows-10-is-in-microsoft-edge/" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="6096fbd00a69c3d4797015098833752b" data-thumbnail-img-id="0*x_8tGgx3lGSvJ3WZ" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*x_8tGgx3lGSvJ3WZ);"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@french-tech-lead" class="p-author h-card">MECHERI Akram</a> on <a href="https://medium.com/p/4278fa40215f"><time class="dt-published" datetime="2021-06-15T21:57:34.395Z">June 15, 2021</time></a>.</p><p><a href="https://medium.com/@french-tech-lead/the-weirdest-bug-that-i-faced-during-my-software-engineering-career-4278fa40215f" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on April 17, 2022.</p></footer></article></body></html>
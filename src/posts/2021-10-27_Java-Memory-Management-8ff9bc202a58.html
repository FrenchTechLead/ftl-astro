<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Java Memory Management</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Java Memory Management</h1>
</header>
<section data-field="subtitle" class="p-summary">
In this short article, I‚Äôll try to briefly explain how Java manages Random Access Memory (RAM), explaining the basics of garbage‚Ä¶
</section>
<section data-field="body" class="e-content">
<section name="7156" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="148b" id="148b" class="graf graf--h3 graf--leading graf--title">Java Memory Management</h3><figure name="5b8f" id="5b8f" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*P8cBq8x0FMqdOZjApYTDNw.png" data-width="1818" data-height="984" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*P8cBq8x0FMqdOZjApYTDNw.png"></figure><p name="5059" id="5059" class="graf graf--p graf-after--figure graf--trailing">In this short article, I‚Äôll try to briefly explain how Java manages Random Access Memory (RAM), explaining the basics of garbage collecting, the two main Memory types in Java, Memory Leaks: how to diagnose them and how to ensure that your application handles the memory the right way.</p></div></div></section><section name="113b" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="6db1" id="6db1" class="graf graf--h4 graf--leading">Types of memories in a¬†computer</h4><figure name="f11d" id="f11d" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*04S611TdmKJZrK_d9OIr9g.png" data-width="1536" data-height="702" src="https://cdn-images-1.medium.com/max/800/1*04S611TdmKJZrK_d9OIr9g.png"><figcaption class="imageCaption">Types of memories in a¬†computer</figcaption></figure><p name="48bf" id="48bf" class="graf graf--p graf-after--figure">We find in a computer three main types of memories, <strong class="markup--strong markup--p-strong">Read-Only Memory ROM</strong> is physically contained on the motherboard of the computer, it contains the programming needed to start a PC, which is essential for boot-up; it performs major input/output tasks and holds programs or software instructions, on the other hand, <strong class="markup--strong markup--p-strong">Disc Memory</strong> is used for containing large files such as operating systems and multimedia files, it has a low Read/Write speed comparing to RAM.</p><p name="16dc" id="16dc" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Random Access Memory (RAM)</strong> is a volatile type of memory, which means that its content is not permanent, it only exists for a short period of time during the execution of software, in other words, RAM provides storage for input data that the processor handles and storage for the resulting output data.</p><h4 name="14c5" id="14c5" class="graf graf--h4 graf-after--p">How does the JVM use¬†RAM?</h4><figure name="a5cf" id="a5cf" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*HD7b-AUnzYkTfShm1g35jA.png" data-width="1202" data-height="706" src="https://cdn-images-1.medium.com/max/800/1*HD7b-AUnzYkTfShm1g35jA.png"><figcaption class="imageCaption">The two main Java Memory¬†types</figcaption></figure><p name="df74" id="df74" class="graf graf--p graf-after--figure">The Java Virtual Machine (JVM) uses RAM memory in two main ways, the first one is the <strong class="markup--strong markup--p-strong">Stack</strong>, it‚Äôs an ordered data structure that can be compared to books that are put one on top of each other, the second one is <strong class="markup--strong markup--p-strong">Heap</strong> which has no particular order.</p><figure name="1f6a" id="1f6a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*a5yRGsgZMkj2Vxh8Uzc1JQ.png" data-width="1196" data-height="706" src="https://cdn-images-1.medium.com/max/800/1*a5yRGsgZMkj2Vxh8Uzc1JQ.png"><figcaption class="imageCaption">Stack Vs¬†Heap</figcaption></figure><p name="55b9" id="55b9" class="graf graf--p graf-after--figure">Actually, there are N number of stacks per Java process, where N is equal to the number of Java threads being executed, 1 Thread = 1 Stack.</p><p name="3ec0" id="3ec0" class="graf graf--p graf-after--p">On the other hand, there is only one Java Heap per Java process.</p><figure name="9693" id="9693" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*5VHZ3EjDt2ZNfdiqdM5GBg.gif" data-width="486" data-height="276" src="https://cdn-images-1.medium.com/max/800/1*5VHZ3EjDt2ZNfdiqdM5GBg.gif"><figcaption class="imageCaption">The Stack is a LIFO data structure</figcaption></figure><p name="7826" id="7826" class="graf graf--p graf-after--figure">Stack memory is always referenced in LIFO (Last-In-First-Out) order. <strong class="markup--strong markup--p-strong">Whenever a method is invoked, a new block is created on top of the stack memory</strong> for the method to hold local primitive values and reference to other objects in the method, As soon as the method ends, the block is popped from the top of the stack, Stack memory size is very less compared to Heap memory.</p><figure name="b54e" id="b54e" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*G__UQkmhPg_T37Y-FHpmuw.png" data-width="1362" data-height="788" src="https://cdn-images-1.medium.com/max/800/1*G__UQkmhPg_T37Y-FHpmuw.png"><figcaption class="imageCaption">Stack / Heap¬†usage</figcaption></figure><p name="0f22" id="0f22" class="graf graf--p graf-after--figure graf--trailing">The above example represents the state of the Stack and the heap on the execution of the last line of code of the main method, we notice that the first instructions are on the bottom of the Stack and the last one on the top of it, we also notice that the Stack holds primitive values and references to non-primitive types that are stored on the Heap memory.</p></div></div></section><section name="f0f8" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="2c31" id="2c31" class="graf graf--h4 graf--leading">StackOverFlowError</h4><figure name="277e" id="277e" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*tMWV9vbEowbYpmeMhZqCWQ.png" data-width="1362" data-height="798" src="https://cdn-images-1.medium.com/max/800/1*tMWV9vbEowbYpmeMhZqCWQ.png"><figcaption class="imageCaption">StackOverFlowError¬†!</figcaption></figure><p name="be0b" id="be0b" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">StackOverflowError </strong>is a very common error in Java and in programming in general, it happens when the stack memory is overflowed with content.</p><p name="3ea5" id="3ea5" class="graf graf--p graf-after--p">Like we said before every method invocation creates a block on the top of the stack memory, and since the program of the example above recursively invokes the ‚Äútoto‚Äù method with no stop condition, it causes a StackOverFlow error.</p><h4 name="bbe3" id="bbe3" class="graf graf--h4 graf-after--p">OutOfMemoryError</h4><figure name="7560" id="7560" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*wZ1xqYA8C3iD1trr5B9isg.png" data-width="1362" data-height="800" src="https://cdn-images-1.medium.com/max/800/1*wZ1xqYA8C3iD1trr5B9isg.png"><figcaption class="imageCaption">OutOfMemoryError</figcaption></figure><p name="d60f" id="d60f" class="graf graf--p graf-after--figure graf--trailing"><strong class="markup--strong markup--p-strong">OutOfMemoryError </strong>is another common error in the Java world, it concerns the heap memory and happens when there is no more heap space to allocate for new objects, the above program creates new entries in a List of Strings until there is no more heap space for it.</p></div></div></section><section name="472a" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="652e" id="652e" class="graf graf--h4 graf--leading">Memory Leaks</h4><figure name="91af" id="91af" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*Ov4i1YYdPNlaRkrdK-gAVw.png" data-width="1362" data-height="794" src="https://cdn-images-1.medium.com/max/800/1*Ov4i1YYdPNlaRkrdK-gAVw.png"><figcaption class="imageCaption">The cause of Memory Leak in¬†Java</figcaption></figure><p name="0e59" id="0e59" class="graf graf--p graf-after--figure graf--trailing"><strong class="markup--strong markup--p-strong">Java memory leak</strong> happens when an application unintentionally (due to logical errors in code) holds on to object references that are no longer required. These unintentional object references prevent the built-in Java garbage collection mechanism from freeing up the memory consumed by these objects.</p></div></div></section><section name="be72" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="dfca" id="dfca" class="graf graf--h4 graf--leading">Performing a Heap Dump with¬†Intellij</h4><p name="a889" id="a889" class="graf graf--p graf-after--h4">There are several ways to perfom a JVM Heap Dump using one of the many tools of the Java eco-system, most of the tools are prety similars, so what‚Äôs we‚Äôre going to see here with Intellij can be done with any other tool such as VisualVM or JDK Mission control¬†‚Ä¶</p><blockquote name="5a95" id="5a95" class="graf graf--blockquote graf-after--p">The infinit loop of the following program will allow the java process to be running while we perform the Heap Dump.</blockquote><figure name="3d43" id="3d43" class="graf graf--figure graf-after--blockquote"><img class="graf-image" data-image-id="1*G94FFlkOsCCdlF9QaZiVNQ.png" data-width="1598" data-height="784" src="https://cdn-images-1.medium.com/max/800/1*G94FFlkOsCCdlF9QaZiVNQ.png"><figcaption class="imageCaption">Simple Java program to analyse with Intellij‚Äôs Profiler</figcaption></figure><p name="a5e1" id="a5e1" class="graf graf--p graf-after--figure">Let‚Äôs run this simple program in Intellij‚Äôs IDE, and perform a Heap Dump using the default profiler of Intellij:</p><figure name="35e5" id="35e5" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*RsFSNC4_54mfN733OY-ETg.png" data-width="2560" data-height="693" src="https://cdn-images-1.medium.com/max/800/1*RsFSNC4_54mfN733OY-ETg.png"><figcaption class="imageCaption">Capture a Memory Snapshot using¬†Intellij</figcaption></figure><p name="f29f" id="f29f" class="graf graf--p graf-after--figure">When capturing a memory snapshot of the running process, intellij will create a¬†.hprof file and parse it in the following tab¬†:</p><figure name="c37b" id="c37b" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*g3l_9VB5KfZd98RuCxfQFg.png" data-width="2560" data-height="689" src="https://cdn-images-1.medium.com/max/800/1*g3l_9VB5KfZd98RuCxfQFg.png"><figcaption class="imageCaption">Heap Dump parsed¬†content</figcaption></figure><p name="6799" id="6799" class="graf graf--p graf-after--figure">We observe that the largest object of our program is of type Main (the class we created), and that‚Äôs because it contains large static field str.</p><p name="6d6d" id="6d6d" class="graf graf--p graf-after--p graf--trailing">This view shows the state of the heap memory when the heap dump was performed, this helps a lot for analysing memory leaks in large apps, we observe that there are a lot of objects loaded on the heap by JDK for our simple Java program, we must then pay attention when including libraries to our Java apps because they can overload the heap memory.</p></div></div></section><section name="9f6a" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="69c2" id="69c2" class="graf graf--p graf--leading">There are several good practices and must-dos when it comes to writing memory efficient Java code, the following are some of them¬†:</p><h4 name="a5ea" id="a5ea" class="graf graf--h4 graf-after--p">Java good practice¬†1</h4><p name="e558" id="e558" class="graf graf--p graf-after--h4">Always declare variables in<strong class="markup--strong markup--p-strong"> the smallest possible scopes</strong>, so that they are picked up by the Garbage Collector as soon as possible.</p><figure name="39c9" id="39c9" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*4ZsET7VuZjOLCU1HOnrK5Q.png" data-width="1260" data-height="502" src="https://cdn-images-1.medium.com/max/800/1*4ZsET7VuZjOLCU1HOnrK5Q.png"></figure><h4 name="f50a" id="f50a" class="graf graf--h4 graf-after--figure">Java good practice¬†2</h4><p name="d2d7" id="d2d7" class="graf graf--p graf-after--h4"><strong class="markup--strong markup--p-strong">The use of static attributes and methods must be justified.</strong></p><p name="c626" id="c626" class="graf graf--p graf-after--p">Java objects are created at their instantiation and destroyed after they are dereferenced. static attributes and methods are created when their class is loaded by the classLoader, and are only destroyed when the classLoader is itself picked up by the GC, for these reasons you need to use static fields/methods only when it‚Äôs convenient.</p><h4 name="4da1" id="4da1" class="graf graf--h4 graf-after--p">Java must¬†do</h4><figure name="8abe" id="8abe" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*Qgpk4NyN_LWQ9Y8w5WUT1w.png" data-width="1270" data-height="438" src="https://cdn-images-1.medium.com/max/800/1*Qgpk4NyN_LWQ9Y8w5WUT1w.png"><figcaption class="imageCaption">AutoClose IO Streams using try-with-resources</figcaption></figure><p name="dbef" id="dbef" class="graf graf--p graf-after--figure">Always close IO Streams!</p><p name="187a" id="187a" class="graf graf--p graf-after--p">You need to make sure to close IO Streams after using them, you can do so by closing the Stream in a ‚Äú<strong class="markup--strong markup--p-strong">finally</strong>‚Äù block following a<strong class="markup--strong markup--p-strong"> ‚Äútry-catch‚Äù</strong> statement or by using a ‚Äú<strong class="markup--strong markup--p-strong">try-with-resources‚Äù</strong> statement, but for that, you need to make sure that your IO Stream implements the Autocloseable interface.</p><h4 name="84a7" id="84a7" class="graf graf--h4 graf-after--p">Maven good practices</h4><ul class="postList"><li name="2732" id="2732" class="graf graf--li graf-after--h4"><strong class="markup--strong markup--li-strong">Add only reliable dependencies.</strong></li></ul><p name="e3d6" id="e3d6" class="graf graf--p graf-after--li">Make sure that the libraries that you use in your project are reliable, maintained, and well designed, some libraries might cause memory leaks under the hood.</p><ul class="postList"><li name="be98" id="be98" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">The addition of a dependency in a project must be justified.</strong></li></ul><p name="3e17" id="3e17" class="graf graf--p graf-after--li">You need to make sure that the dependencies you are using in your project are necessary, you don‚Äôt add a whole Maven library to only consume one method of it because this will only add unnecessary entries to your classpath.</p><ul class="postList"><li name="4e96" id="4e96" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Adapt the maven dependency scopes (test / runtime / compile¬†‚Ä¶).</strong></li></ul><p name="5cd0" id="5cd0" class="graf graf--p graf-after--li">This will make sure that the dependency is added to the classpath at the convenient scope, eg: a test library is needed only during the test stage and doesn‚Äôt have to be loaded by the classloader during the runtime of your Java app.</p></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="2"><figure name="140e" id="140e" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--p" style="width: 44.158%;"><img class="graf-image" data-image-id="1*tyYNVK21VUBLtLrCKQbY6w.png" data-width="718" data-height="364" src="https://cdn-images-1.medium.com/max/600/1*tyYNVK21VUBLtLrCKQbY6w.png"></figure><figure name="2601" id="2601" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 55.842%;"><img class="graf-image" data-image-id="1*pvCREPVWu9qkrjJwUInSeA.png" data-width="908" data-height="364" src="https://cdn-images-1.medium.com/max/800/1*pvCREPVWu9qkrjJwUInSeA.png"><figcaption class="imageCaption" style="width: 179.077%; left: -79.077%;">Adapt the scope of the Maven dependencies</figcaption></figure></div><div class="section-inner sectionLayout--insetColumn"><h4 name="8f1e" id="8f1e" class="graf graf--h4 graf-after--figure">JVM good practices</h4><ul class="postList"><li name="7265" id="7265" class="graf graf--li graf-after--h4">Define the amount of memory reserved for the initialization of the JVM ex: <code class="markup--code markup--li-code">-Xms256m</code></li><li name="da7b" id="da7b" class="graf graf--li graf-after--li">Define the max memory size that the JVM can allocate ex: <code class="markup--code markup--li-code">-Xmx2048m</code></li><li name="0a2d" id="0a2d" class="graf graf--li graf-after--li graf--trailing">Define the Garbage Collector execution mode that best suits your configuration ex: <code class="markup--code markup--li-code">-XX: + UseSerialGC</code></li></ul></div></div></section><section name="9ba4" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="9a05" id="9a05" class="graf graf--p graf--leading graf--trailing"><strong class="markup--strong markup--p-strong">That‚Äôs it</strong>, if you find this article interesting don‚Äôt hesitate to let me a comment and/or hit the üëè button below.</p></div></div></section><section name="da2d" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="54af" id="54af" class="graf graf--h4 graf--leading">More from the same¬†author</h4><div name="1abc" id="1abc" class="graf graf--mixtapeEmbed graf-after--h4"><a href="https://mecheri-akram.medium.com/the-weirdest-java-interview-questions-that-you-ever-heard-of-2ec8b24be8ff" data-href="https://mecheri-akram.medium.com/the-weirdest-java-interview-questions-that-you-ever-heard-of-2ec8b24be8ff" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://mecheri-akram.medium.com/the-weirdest-java-interview-questions-that-you-ever-heard-of-2ec8b24be8ff"><strong class="markup--strong markup--mixtapeEmbed-strong">The Weirdest Java Interview Questions That You Ever Heard Of</strong><br><em class="markup--em markup--mixtapeEmbed-em">This is a post that gathers the weirdest Java interview questions that I personally faced during job interviews or‚Ä¶</em>mecheri-akram.medium.com</a><a href="https://mecheri-akram.medium.com/the-weirdest-java-interview-questions-that-you-ever-heard-of-2ec8b24be8ff" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="59ea9742607621eab2a3ddc1f0100f87" data-thumbnail-img-id="1*_ylEDFO3_rtwlcjkdg6Qvg.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*_ylEDFO3_rtwlcjkdg6Qvg.png);"></a></div><div name="f177" id="f177" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed"><a href="https://medium.com/geekculture/the-weirdest-bug-that-i-faced-during-my-software-engineering-career-4278fa40215f" data-href="https://medium.com/geekculture/the-weirdest-bug-that-i-faced-during-my-software-engineering-career-4278fa40215f" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/geekculture/the-weirdest-bug-that-i-faced-during-my-software-engineering-career-4278fa40215f"><strong class="markup--strong markup--mixtapeEmbed-strong">The Hardest Production Bug That I Faced During My Software Engineering Career.</strong><br><em class="markup--em markup--mixtapeEmbed-em">In this article, I‚Äôll describe the weirdest Internet Explorer bug that I faced in my life, how we diagnosed it, and the‚Ä¶</em>medium.com</a><a href="https://medium.com/geekculture/the-weirdest-bug-that-i-faced-during-my-software-engineering-career-4278fa40215f" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="d09f098b34be05cede0b2c7068e07d7c" data-thumbnail-img-id="1*DoBX7LLi0KKOvKHUOseUsQ.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*DoBX7LLi0KKOvKHUOseUsQ.png);"></a></div><div name="f2ec" id="f2ec" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed graf--trailing"><a href="https://mecheri-akram.medium.com/how-i-created-a-new-programming-language-based-on-java-%EF%B8%8F-f88d0a522cca" data-href="https://mecheri-akram.medium.com/how-i-created-a-new-programming-language-based-on-java-%EF%B8%8F-f88d0a522cca" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://mecheri-akram.medium.com/how-i-created-a-new-programming-language-based-on-java-%EF%B8%8F-f88d0a522cca"><strong class="markup--strong markup--mixtapeEmbed-strong">How To Create Your Own Programming Language Based On Java ‚ô®Ô∏è</strong><br><em class="markup--em markup--mixtapeEmbed-em">I graduated from college in 2017, one year later one of my professors asked me to come and teach some computer science‚Ä¶</em>mecheri-akram.medium.com</a><a href="https://mecheri-akram.medium.com/how-i-created-a-new-programming-language-based-on-java-%EF%B8%8F-f88d0a522cca" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="cbf573c5d3ae5f51268208787a0d6649" data-thumbnail-img-id="1*BdR8j03redg3NFcG6zXQeg.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*BdR8j03redg3NFcG6zXQeg.png);"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@french-tech-lead" class="p-author h-card">MECHERI Akram</a> on <a href="https://medium.com/p/8ff9bc202a58"><time class="dt-published" datetime="2021-10-27T12:18:03.504Z">October 27, 2021</time></a>.</p><p><a href="https://medium.com/@french-tech-lead/java-memory-management-8ff9bc202a58" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on April 17, 2022.</p></footer></article></body></html>